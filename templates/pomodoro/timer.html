{# templates/pomodoro/timer.html #}
{% load static %}
{% extends 'base.html' %}

{% block title %}ğŸ… í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸{% endblock %}

{% block content %}
<div class="container py-5">

  <!-- â”€â”€ í—¤ë”: ë¡œê³  + íƒ€ì´í‹€/íƒœê·¸ë¼ì¸ â”€â”€ -->
  <div class="d-flex align-items-center mb-5">
    <img src="{% static 'pomodoro/logo.png' %}"
         alt="Pomodoro ë¡œê³ "
         width="80"
         class="me-4">
    <div>
      <h1 class="display-4 mb-1">ğŸ… í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸</h1>
      <!-- ë¼ì¸ ë¶„ë¦¬ëœ íƒœê·¸ë¼ì¸ -->
      <p class="lead text-secondary mb-0">
        â±ï¸ 25ë¶„ ì§‘ì¤‘ &nbsp;â€¢&nbsp; â²ï¸ íœ´ì‹ &nbsp;â€¢&nbsp; ğŸ“ ê¸°ë¡
      </p>
    </div>
  </div>

  <!-- â”€â”€ íƒ€ì´ë¨¸ ì¹´ë“œ â”€â”€ -->
  <div class="card text-center mb-5 shadow-sm">
    <div class="card-body">
      <div id="timer" class="display-1 mb-4">25:00</div>
      <button id="startBtn" class="btn btn-success me-2">
        <i class="bi bi-play-fill"></i> ì‹œì‘
      </button>
      <button id="resetBtn" class="btn btn-danger">
        <i class="bi bi-arrow-counterclockwise"></i> ë¦¬ì…‹
      </button>
    </div>
  </div>

  <!-- â”€â”€ ì˜¤ëŠ˜ ì„¸ì…˜ ìˆ˜ â”€â”€ -->
  <div class="card mb-5 shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <i class="bi bi-list-check fs-2 text-primary me-3"></i>
        <span class="h5 mb-0">ì˜¤ëŠ˜ ì„¸ì…˜ ìˆ˜</span>
      </div>
      <span class="badge bg-primary fs-5">{{ count }} íšŒ</span>
      <form method="post" action="{% url 'pomodoro:record' %}" class="d-inline">
        {% csrf_token %}
        <button class="btn btn-outline-primary btn-sm ms-3">
          <i class="bi bi-plus-circle"></i> ì™„ë£Œ!
        </button>
      </form>
    </div>
  </div>

  <!-- â”€â”€ ìµœê·¼ ì„¸ì…˜ ê¸°ë¡ â”€â”€ -->
  {% if sessions %}
  <div class="card shadow-sm">
    <div class="card-header bg-light d-flex align-items-center">
      <!-- ê¸°ë¡ ì•„ì´ì½˜ ì¶”ê°€ -->
      <i class="bi bi-journal-text fs-4 me-2"></i>
      <span class="fw-bold">ìµœê·¼ ì„¸ì…˜ ê¸°ë¡</span>
    </div>
    <ul class="list-group list-group-flush">
      {% for s in sessions %}
      <li class="list-group-item d-flex justify-content-between">
        {{ s.date }}
        <span class="badge bg-info text-dark">{{ s.count }} íšŒ</span>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

</div>
{% endblock %}

{% block script %}
<script>
let total = 25*60, timerId;
const display = document.getElementById('timer');
function format(t){
  return `${String(Math.floor(t/60)).padStart(2,'0')}:${String(t%60).padStart(2,'0')}`;
}
document.getElementById('startBtn').onclick = ()=>{
  clearInterval(timerId);
  timerId = setInterval(()=>{
    if(total<=0) clearInterval(timerId);
    display.textContent = format(--total);
  },1000);
};
document.getElementById('resetBtn').onclick = ()=>{
  clearInterval(timerId);
  total = 25*60;
  display.textContent = format(total);
};
</script>
{% endblock %}
